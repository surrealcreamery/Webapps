{
  "version": 3,
  "sources": ["../../@xstate/react/dist/xstate-react.development.esm.js", "../../use-isomorphic-layout-effect/dist/use-isomorphic-layout-effect.browser.esm.js"],
  "sourcesContent": ["import * as React from 'react';\nimport { useEffect, useState, useCallback } from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\nimport { toObserver, createActor } from 'xstate';\nimport { useSyncExternalStoreWithSelector } from 'use-sync-external-store/shim/with-selector';\nimport { useSyncExternalStore } from 'use-sync-external-store/shim';\n\nconst forEachActor = (actorRef, callback) => {\n  callback(actorRef);\n  const children = actorRef.getSnapshot().children;\n  if (children) {\n    Object.values(children).forEach(child => {\n      forEachActor(child, callback);\n    });\n  }\n};\nfunction stopRootWithRehydration(actorRef) {\n  // persist snapshot here in a custom way allows us to persist inline actors and to preserve actor references\n  // we do it to avoid setState in useEffect when the effect gets \"reconnected\"\n  // this currently only happens in Strict Effects but it simulates the Offscreen aka Activity API\n  // it also just allows us to end up with a somewhat more predictable behavior for the users\n  const persistedSnapshots = [];\n  forEachActor(actorRef, ref => {\n    persistedSnapshots.push([ref, ref.getSnapshot()]);\n    // muting observers allow us to avoid `useSelector` from being notified about the stopped snapshot\n    // React reconnects its subscribers (from the useSyncExternalStore) on its own\n    // and userland subscribers should basically always do the same anyway\n    // as each subscription should have its own cleanup logic and that should be called each such reconnect\n    ref.observers = new Set();\n  });\n  const systemSnapshot = actorRef.system.getSnapshot?.();\n  actorRef.stop();\n  actorRef.system._snapshot = systemSnapshot;\n  persistedSnapshots.forEach(([ref, snapshot]) => {\n    ref._processingStatus = 0;\n    ref._snapshot = snapshot;\n  });\n}\n\nfunction useIdleActorRef(logic, ...[options]) {\n  let [[currentConfig, actorRef], setCurrent] = useState(() => {\n    const actorRef = createActor(logic, options);\n    return [logic.config, actorRef];\n  });\n  if (logic.config !== currentConfig) {\n    const newActorRef = createActor(logic, {\n      ...options,\n      snapshot: actorRef.getPersistedSnapshot({\n        __unsafeAllowInlineActors: true\n      })\n    });\n    setCurrent([logic.config, newActorRef]);\n    actorRef = newActorRef;\n  }\n\n  // TODO: consider using `useAsapEffect` that would do this in `useInsertionEffect` is that's available\n  useIsomorphicLayoutEffect(() => {\n    actorRef.logic.implementations = logic.implementations;\n  });\n  return actorRef;\n}\nfunction useActorRef(machine, ...[options, observerOrListener]) {\n  const actorRef = useIdleActorRef(machine, options);\n  useEffect(() => {\n    if (!observerOrListener) {\n      return;\n    }\n    const sub = actorRef.subscribe(toObserver(observerOrListener));\n    return () => {\n      sub.unsubscribe();\n    };\n  }, [observerOrListener]);\n  useEffect(() => {\n    actorRef.start();\n    return () => {\n      stopRootWithRehydration(actorRef);\n    };\n  }, [actorRef]);\n  return actorRef;\n}\n\nfunction defaultCompare(a, b) {\n  return a === b;\n}\nfunction useSelector(actor, selector, compare = defaultCompare) {\n  const subscribe = useCallback(handleStoreChange => {\n    if (!actor) {\n      return () => {};\n    }\n    const {\n      unsubscribe\n    } = actor.subscribe(handleStoreChange);\n    return unsubscribe;\n  }, [actor]);\n  const boundGetSnapshot = useCallback(() => actor?.getSnapshot(), [actor]);\n  const selectedSnapshot = useSyncExternalStoreWithSelector(subscribe, boundGetSnapshot, boundGetSnapshot, selector, compare);\n  return selectedSnapshot;\n}\n\nfunction createActorContext(actorLogic, actorOptions) {\n  const ReactContext = /*#__PURE__*/React.createContext(null);\n  const OriginalProvider = ReactContext.Provider;\n  function Provider({\n    children,\n    logic: providedLogic = actorLogic,\n    machine,\n    options: providedOptions\n  }) {\n    if (machine) {\n      throw new Error(`The \"machine\" prop has been deprecated. Please use \"logic\" instead.`);\n    }\n    const actor = useActorRef(providedLogic, {\n      ...actorOptions,\n      ...providedOptions\n    });\n    return /*#__PURE__*/React.createElement(OriginalProvider, {\n      value: actor,\n      children\n    });\n  }\n\n  // TODO: add properties to actor ref to make more descriptive\n  Provider.displayName = `ActorProvider`;\n  function useContext() {\n    const actor = React.useContext(ReactContext);\n    if (!actor) {\n      throw new Error(`You used a hook from \"${Provider.displayName}\" but it's not inside a <${Provider.displayName}> component.`);\n    }\n    return actor;\n  }\n  function useSelector$1(selector, compare) {\n    const actor = useContext();\n    return useSelector(actor, selector, compare);\n  }\n  return {\n    Provider: Provider,\n    useActorRef: useContext,\n    useSelector: useSelector$1\n  };\n}\n\n// From https://github.com/reduxjs/react-redux/blob/720f0ba79236cdc3e1115f4ef9a7760a21784b48/src/utils/shallowEqual.ts\nfunction is(x, y) {\n  if (x === y) {\n    return x !== 0 || y !== 0 || 1 / x === 1 / y;\n  } else {\n    return x !== x && y !== y;\n  }\n}\nfunction shallowEqual(objA, objB) {\n  if (is(objA, objB)) return true;\n  if (typeof objA !== 'object' || objA === null || typeof objB !== 'object' || objB === null) {\n    return false;\n  }\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n  if (keysA.length !== keysB.length) return false;\n  for (let i = 0; i < keysA.length; i++) {\n    if (!Object.prototype.hasOwnProperty.call(objB, keysA[i]) || !is(objA[keysA[i]], objB[keysA[i]])) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction useActor(logic, ...[options]) {\n  if (!!logic && 'send' in logic && typeof logic.send === 'function') {\n    throw new Error(`useActor() expects actor logic (e.g. a machine), but received an ActorRef. Use the useSelector(actorRef, ...) hook instead to read the ActorRef's snapshot.`);\n  }\n  const actorRef = useIdleActorRef(logic, options);\n  const getSnapshot = useCallback(() => {\n    return actorRef.getSnapshot();\n  }, [actorRef]);\n  const subscribe = useCallback(handleStoreChange => {\n    const {\n      unsubscribe\n    } = actorRef.subscribe(handleStoreChange);\n    return unsubscribe;\n  }, [actorRef]);\n  const actorSnapshot = useSyncExternalStore(subscribe, getSnapshot, getSnapshot);\n  useEffect(() => {\n    actorRef.start();\n    return () => {\n      stopRootWithRehydration(actorRef);\n    };\n  }, [actorRef]);\n  return [actorSnapshot, actorRef.send, actorRef];\n}\n\n/** @alias useActor */\nfunction useMachine(machine, ...[options]) {\n  return useActor(machine, options);\n}\n\nexport { createActorContext, shallowEqual, useActor, useActorRef, useMachine, useSelector };\n", "import { useLayoutEffect } from 'react';\n\nvar index = useLayoutEffect ;\n\nexport { index as default };\n"],
  "mappings": "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",
  "names": ["import_react", "actorRef", "useContext"]
}
